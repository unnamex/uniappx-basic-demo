/**
 * é™æ€èµ„æºç±»å‹å®šä¹‰
 * @description å®šä¹‰å·¥è‰º/å·¥åº/å·¥æ­¥å…³è”çš„å¤šåª’ä½“èµ„æºç±»å‹
 */

/**
 * èµ„æºç±»å‹å¸¸é‡
 */
export const ResourceType = {
	IMAGE: 'image',
	VIDEO: 'video',
	AUDIO: 'audio',
	DOCUMENT: 'document'
}

/**
 * èµ„æºé¡¹ç±»å‹
 */
export type ResourceItem = {
	id: string              // å”¯ä¸€ID: "res_001"
	type: string            // èµ„æºç±»å‹: image | video | audio | document
	name: string            // æ˜¾ç¤ºåç§°: "è£…é…ç¤ºæ„å›¾"
	path: string            // æœ¬åœ°å­˜å‚¨è·¯å¾„ï¼ˆå¯¼å…¥åæ›´æ–°ï¼‰
	originalPath: string    // åŸå§‹åŒ…å†…è·¯å¾„: "assets/images/img_001.jpg"
	thumbnail: string       // ç¼©ç•¥å›¾è·¯å¾„ï¼ˆå›¾ç‰‡å¯ä¸ºç©ºï¼Œè§†é¢‘/éŸ³é¢‘éœ€è¦ï¼‰
	duration: number        // æ—¶é•¿ï¼ˆè§†é¢‘/éŸ³é¢‘ï¼Œç§’ï¼‰, 0 è¡¨ç¤ºæ— æ—¶é•¿
	size: number            // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰, 0 è¡¨ç¤ºæœªçŸ¥
	description: string     // æè¿°
	nodeId: string          // å…³è”èŠ‚ç‚¹IDï¼ˆå·¥è‰º/å·¥åº/å·¥æ­¥ï¼‰
	sortOrder: number       // æ’åºåºå·
}

/**
 * é¢„è§ˆçŠ¶æ€ç±»å‹
 */
export type PreviewState = {
	resource: ResourceItem | null  // å½“å‰é¢„è§ˆçš„èµ„æº
	isPlaying: boolean             // æ˜¯å¦æ­£åœ¨æ’­æ”¾ï¼ˆè§†é¢‘/éŸ³é¢‘ï¼‰
	currentTime: number            // å½“å‰æ’­æ”¾æ—¶é—´ï¼ˆç§’ï¼‰
	duration: number               // æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
}

/**
 * èµ„æºåˆ—è¡¨æ•°æ®ï¼ˆæŒ‰èŠ‚ç‚¹åˆ†ç»„ï¼‰
 */
export type NodeResources = {
	nodeId: string           // èŠ‚ç‚¹ID
	nodeName: string         // èŠ‚ç‚¹åç§°
	nodeType: string         // èŠ‚ç‚¹ç±»å‹: process | procedure | step
	resources: ResourceItem[] // èµ„æºåˆ—è¡¨
}

/**
 * è·å–èµ„æºç±»å‹å›¾æ ‡
 * @param type èµ„æºç±»å‹
 * @returns å›¾æ ‡ emoji
 */
export function getResourceTypeIcon(type: string): string {
	if (type == ResourceType.IMAGE) return 'ğŸ–¼ï¸'
	if (type == ResourceType.VIDEO) return 'ğŸ¬'
	if (type == ResourceType.AUDIO) return 'ğŸ”Š'
	if (type == ResourceType.DOCUMENT) return 'ğŸ“„'
	return 'ğŸ“'
}

/**
 * è·å–èµ„æºç±»å‹æ ‡ç­¾
 * @param type èµ„æºç±»å‹
 * @returns ç±»å‹ä¸­æ–‡å
 */
export function getResourceTypeLabel(type: string): string {
	if (type == ResourceType.IMAGE) return 'å›¾ç‰‡'
	if (type == ResourceType.VIDEO) return 'è§†é¢‘'
	if (type == ResourceType.AUDIO) return 'éŸ³é¢‘'
	if (type == ResourceType.DOCUMENT) return 'æ–‡æ¡£'
	return 'é™„ä»¶'
}

/**
 * æ ¼å¼åŒ–æ—¶é•¿æ˜¾ç¤º
 * @param seconds ç§’æ•°
 * @returns æ ¼å¼åŒ–å­—ç¬¦ä¸² mm:ss
 */
export function formatDuration(seconds: number): string {
	if (seconds <= 0) return ''
	const mins = Math.floor(seconds / 60)
	const secs = Math.floor(seconds % 60)
	const minsStr = mins < 10 ? '0' + mins.toString() : mins.toString()
	const secsStr = secs < 10 ? '0' + secs.toString() : secs.toString()
	return `${minsStr}:${secsStr}`
}

/**
 * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
 * @param bytes å­—èŠ‚æ•°
 * @returns æ ¼å¼åŒ–å­—ç¬¦ä¸²
 */
export function formatFileSize(bytes: number): string {
	if (bytes <= 0) return ''
	if (bytes < 1024) return bytes.toString() + ' B'
	if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB'
	if (bytes < 1024 * 1024 * 1024) return (bytes / 1024 / 1024).toFixed(1) + ' MB'
	return (bytes / 1024 / 1024 / 1024).toFixed(2) + ' GB'
}

/**
 * æ ¹æ®æ–‡ä»¶æ‰©å±•åæ¨æ–­èµ„æºç±»å‹
 * @param filename æ–‡ä»¶å
 * @returns èµ„æºç±»å‹
 */
export function inferResourceType(filename: string): string {
	const ext = filename.toLowerCase().split('.').pop() ?? ''
	
	// å›¾ç‰‡æ ¼å¼
	if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'].indexOf(ext) >= 0) {
		return ResourceType.IMAGE
	}
	
	// è§†é¢‘æ ¼å¼
	if (['mp4', 'webm', 'mov', 'avi', 'mkv', 'm4v'].indexOf(ext) >= 0) {
		return ResourceType.VIDEO
	}
	
	// éŸ³é¢‘æ ¼å¼
	if (['mp3', 'wav', 'aac', 'ogg', 'm4a', 'flac'].indexOf(ext) >= 0) {
		return ResourceType.AUDIO
	}
	
	// æ–‡æ¡£æ ¼å¼
	if (['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt'].indexOf(ext) >= 0) {
		return ResourceType.DOCUMENT
	}
	
	return 'unknown'
}
